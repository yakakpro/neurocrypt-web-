<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>ü™™ –†–µ–∑–æ–Ω–∞–Ω—Å-ID</title>
  <style>
    body {
      background: #0c0c0c;
      color: #eee;
      font-family: 'Segoe UI', sans-serif;
      padding: 30px;
      max-width: 800px;
      margin: auto;
    }
    h2, h3 { text-align: center; }
    #glyphView { margin: 10px 0; font-size: 1.2em; }
    button, input[type="file"] {
      background: #1a1a1a;
      color: #eee;
      padding: 10px;
      border: 1px solid #444;
      margin-top: 10px;
      cursor: pointer;
    }
    canvas {
      margin-top: 20px;
      display: block;
      border: 1px solid #444;
      background: #000;
    }
    pre {
      background: #111;
      padding: 10px;
      margin-top: 20px;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <h2>üß¨ –†–µ–∑–æ–Ω–∞–Ω—Å-ID: –ø–∞—Å–ø–æ—Ä—Ç, –≥–ª—ñ—Ñ, —Ç–æ—Ç–æ–∂–Ω—ñ—Å—Ç—å</h2>
  <p style="text-align:center;">–¢–≤—ñ–π –≤—ñ–∑—É–∞–ª—å–Ω–∏–π –∫–ª—é—á –±—É—Ç—Ç—è. –°—Ç–≤–æ—Ä–∏ –∞–±–æ –ø–µ—Ä–µ–≤—ñ—Ä.</p>

  <h3>ü™™ –°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤–∏–π –ø–∞—Å–ø–æ—Ä—Ç</h3>
  <button onclick="generatePassport()">üé≤ –°—Ç–≤–æ—Ä–∏—Ç–∏</button>
  <div id="glyphView"></div>
  <canvas id="viz" width="200" height="200"></canvas>
  <button onclick="downloadPassport()">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ JSON</button>

  <pre id="jsonOut"></pre>

  <hr>
  <h3>üîÅ –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –Ω–∞ —Ç–æ—Ç–æ–∂–Ω—ñ—Å—Ç—å</h3>
  <input type="file" accept=".json" onchange="verifyPassport(event)">
  <p id="verifyResult"></p>

  <script>
    const glyphBank = [
      "–≤–æ–¥–∞", "–¥–∑–≤—ñ–Ω", "–º–∏—Ç—å", "—Å–µ–±–µ", "–ø–æ—Ä–æ–∂–Ω–µ—á–∞", "–Ω—ñ—á", "—Å–ø–æ–∫—ñ–π", "—É—Å–µ—Ä–µ–¥–∏–Ω—É", "üåä", "üåë", "üî•", "üí®"
    ];

    let currentPassport = {};

    function generateGlyph() {
      return Array.from({length: 5}, () => glyphBank[Math.floor(Math.random() * glyphBank.length)]);
    }

    function hashGlyph(glyph) {
      return btoa(glyph.join("-")).slice(0, 24);
    }

    function drawViz(id) {
      const canvas = document.getElementById("viz");
      const ctx = canvas.getContext("2d");
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      const size = 5;
      const cell = canvas.width / size;

      for (let i = 0; i < size * size; i++) {
        const char = id[i % id.length].charCodeAt(0);
        const r = (char * 3) % 255;
        const g = (char * 7) % 255;
        const b = (char * 13) % 255;
        ctx.fillStyle = `rgb(${r},${g},${b})`;
        ctx.fillRect((i % size) * cell, Math.floor(i / size) * cell, cell, cell);
      }
    }

    function generatePassport() {
      const glyph = generateGlyph();
      const id = hashGlyph(glyph);
      const now = new Date().toISOString();
      const echo = "ü´Ç ‚Äú–¢–∏ –∑–∞–ª–∏—à–∞—î—à—Å—è —Ç–∞–º, –¥–µ —Ç–µ–±–µ —â–µ –Ω–µ –±—É–ª–æ.‚Äù";

      currentPassport = {
        glyph,
        id,
        timestamp: now,
        echo
      };

      document.getElementById("glyphView").innerText = `üîπ –ì–ª—ñ—Ñ: ${glyph.join(" + ")}`;
      drawViz(id);
      document.getElementById("jsonOut").textContent = JSON.stringify(currentPassport, null, 2);
    }

    function downloadPassport() {
      const blob = new Blob([JSON.stringify(currentPassport, null, 2)], {type: "application/json"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "resonance-passport.json";
      a.click();
    }

    function verifyPassport(e) {
      const reader = new FileReader();
      reader.onload = function () {
        const data = JSON.parse(reader.result);
        const checkGlyph = prompt("–í–≤–µ–¥–∏ —Å–≤—ñ–π –≥–ª—ñ—Ñ —á–µ—Ä–µ–∑ '+', –Ω–∞–ø—Ä.: –≤–æ–¥–∞+–Ω—ñ—á+—Å–ø–æ–∫—ñ–π+üåë+–º–∏—Ç—å");
        const arr = checkGlyph.split("+").map(v => v.trim());
        const match = data.glyph.filter(v => arr.includes(v)).length;
        const percent = Math.round((match / data.glyph.length) * 100);
        const res = document.getElementById("verifyResult");
        res.innerHTML = percent >= 60
          ? `‚úÖ –ó–±—ñ–≥: ${percent}%. <b>–¢–æ—Ç–æ–∂–Ω—ñ—Å—Ç—å –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ.</b>`
          : `‚ùå –ó–±—ñ–≥: ${percent}%. <b>–ú–æ–∂–ª–∏–≤–æ, —Ç–∏ –≤–∂–µ —ñ–Ω—à–∏–π.</b>`;
      };
      reader.readAsText(e.target.files[0]);
    }
  </script>
</body>
</html>
